/*!
 Buttons for DataTables 1.3.0
 Â©2016 SpryMedia Ltd - datatables.net/license
*/
(function(d){"function"===typeof define&&define.amd?define(["jquery","datatables.net"],function(x){return d(x,window,document)}):"object"===typeof exports?module.exports=function(x,y){x||(x=window);y&&y.fn.dataTable||(y=require("datatables.net")(x,y).$);return d(y,x,x.document)}:d(jQuery,window,document)})(function(d,x,y,v){var r=d.fn.dataTable,D=0,E=0,t=r.ext.buttons,u=function(a,b){"undefined"===typeof b&&(b={});!0===b&&(b={});d.isArray(b)&&(b={buttons:b});this.c=d.extend(!0,{},u.defaults,b);b.buttons&&
(this.c.buttons=b.buttons);this.s={dt:new r.Api(a),buttons:[],listenKeys:"",namespace:"dtb"+D++};this.dom={container:d("<"+this.c.dom.container.tag+"/>").addClass(this.c.dom.container.className)};this._constructor()};d.extend(u.prototype,{action:function(a,b){a=this._nodeToButton(a);if(b===v)return a.conf.action;a.conf.action=b;return this},active:function(a,b){var c=this._nodeToButton(a);a=this.c.dom.button.active;c=d(c.node);if(b===v)return c.hasClass(a);c.toggleClass(a,b===v?!0:b);return this},
add:function(a,b){var c=this.s.buttons;if("string"===typeof b){b=b.split("-");c=this.s;for(var e=0,f=b.length-1;e<f;e++)c=c.buttons[1*b[e]];c=c.buttons;b=1*b[b.length-1]}this._expandButton(c,a,!1,b);this._draw();return this},container:function(){return this.dom.container},disable:function(a){a=this._nodeToButton(a);d(a.node).addClass(this.c.dom.button.disabled);return this},destroy:function(){d("body").off("keyup."+this.s.namespace);var a=this.s.buttons.slice(),b;var c=0;for(b=a.length;c<b;c++)this.remove(a[c].node);
this.dom.container.remove();a=this.s.dt.settings()[0];c=0;for(b=a.length;c<b;c++)if(a.inst===this){a.splice(c,1);break}return this},enable:function(a,b){if(!1===b)return this.disable(a);a=this._nodeToButton(a);d(a.node).removeClass(this.c.dom.button.disabled);return this},name:function(){return this.c.name},node:function(a){a=this._nodeToButton(a);return d(a.node)},processing:function(a,b){a=this._nodeToButton(a);if(b===v)return d(a.node).hasClass("processing");d(a.node).toggleClass("processing",
b);return this},remove:function(a){var b=this._nodeToButton(a),c=this._nodeToHost(a),e=this.s.dt;if(b.buttons.length)for(var f=b.buttons.length-1;0<=f;f--)this.remove(b.buttons[f].node);b.conf.destroy&&b.conf.destroy.call(e.button(a),e,d(a),b.conf);this._removeKey(b.conf);d(b.node).remove();a=d.inArray(b,c);c.splice(a,1);return this},text:function(a,b){var c=this._nodeToButton(a);a=this.c.dom.collection.buttonLiner;a=c.inCollection&&a&&a.tag?a.tag:this.c.dom.buttonLiner.tag;var e=this.s.dt,f=d(c.node),
h=function(k){return"function"===typeof k?k(e,f,c.conf):k};if(b===v)return h(c.conf.text);c.conf.text=b;a?f.children(a).html(h(b)):f.html(h(b));return this},_constructor:function(){var a=this,b=this.s.dt,c=b.settings()[0],e=this.c.buttons;c._buttons||(c._buttons=[]);c._buttons.push({inst:this,name:this.c.name});c=0;for(var f=e.length;c<f;c++)this.add(e[c]);b.on("destroy",function(){a.destroy()});d("body").on("keyup."+this.s.namespace,function(h){if(!y.activeElement||y.activeElement===y.body){var k=
String.fromCharCode(h.keyCode).toLowerCase();-1!==a.s.listenKeys.toLowerCase().indexOf(k)&&a._keypress(k,h)}})},_addKey:function(a){a.key&&(this.s.listenKeys+=d.isPlainObject(a.key)?a.key.key:a.key)},_draw:function(a,b){a||(a=this.dom.container,b=this.s.buttons);a.children().detach();for(var c=0,e=b.length;c<e;c++)a.append(b[c].inserter),b[c].buttons&&b[c].buttons.length&&this._draw(b[c].collection,b[c].buttons)},_expandButton:function(a,b,c,e){var f=this.s.dt,h=0;b=d.isArray(b)?b:[b];for(var k=0,
g=b.length;k<g;k++){var l=this._resolveExtends(b[k]);if(l)if(d.isArray(l))this._expandButton(a,l,c,e);else{var m=this._buildButton(l,c);if(m){e!==v?(a.splice(e,0,m),e++):a.push(m);if(m.conf.buttons){var p=this.c.dom.collection;m.collection=d("<"+p.tag+"/>").addClass(p.className).attr("role","menu");m.conf._collection=m.collection;this._expandButton(m.buttons,m.conf.buttons,!0,e)}l.init&&l.init.call(f.button(m.node),f,d(m.node),l);h++}}}},_buildButton:function(a,b){var c=this.c.dom.button,e=this.c.dom.buttonLiner,
f=this.c.dom.collection,h=this.s.dt,k=function(m){return"function"===typeof m?m(h,l,a):m};b&&f.button&&(c=f.button);b&&f.buttonLiner&&(e=f.buttonLiner);if(a.available&&!a.available(h,a))return!1;var g=function(m,p,n,w){w.action.call(p.button(n),m,p,n,w);d(p.table().node()).triggerHandler("buttons-action.dt",[p.button(n),p,n,w])},l=d("<"+c.tag+"/>").addClass(c.className).attr("tabindex",this.s.dt.settings()[0].iTabIndex).attr("aria-controls",this.s.dt.table().node().id).on("click.dtb",function(m){m.preventDefault();
!l.hasClass(c.disabled)&&a.action&&g(m,h,l,a);l.blur()}).on("keyup.dtb",function(m){13===m.keyCode&&!l.hasClass(c.disabled)&&a.action&&g(m,h,l,a)});"a"===c.tag.toLowerCase()&&l.attr("href","#");e.tag?(f=d("<"+e.tag+"/>").html(k(a.text)).addClass(e.className),"a"===e.tag.toLowerCase()&&f.attr("href","#"),l.append(f)):l.html(k(a.text));!1===a.enabled&&l.addClass(c.disabled);a.className&&l.addClass(a.className);a.titleAttr&&l.attr("title",k(a.titleAttr));a.namespace||(a.namespace=".dt-button-"+E++);
e=(e=this.c.dom.buttonContainer)&&e.tag?d("<"+e.tag+"/>").addClass(e.className).append(l):l;this._addKey(a);return{conf:a,node:l.get(0),inserter:e,buttons:[],inCollection:b,collection:null}},_nodeToButton:function(a,b){b||(b=this.s.buttons);for(var c=0,e=b.length;c<e;c++){if(b[c].node===a)return b[c];if(b[c].buttons.length){var f=this._nodeToButton(a,b[c].buttons);if(f)return f}}},_nodeToHost:function(a,b){b||(b=this.s.buttons);for(var c=0,e=b.length;c<e;c++){if(b[c].node===a)return b;if(b[c].buttons.length){var f=
this._nodeToHost(a,b[c].buttons);if(f)return f}}},_keypress:function(a,b){var c=function(e){for(var f=0,h=e.length;f<h;f++){var k=e[f].conf,g=e[f].node;k.key&&(k.key===a?d(g).click():!d.isPlainObject(k.key)||k.key.key!==a||k.key.shiftKey&&!b.shiftKey||k.key.altKey&&!b.altKey||k.key.ctrlKey&&!b.ctrlKey||k.key.metaKey&&!b.metaKey||d(g).click());e[f].buttons.length&&c(e[f].buttons)}};c(this.s.buttons)},_removeKey:function(a){if(a.key){var b=d.isPlainObject(a.key)?a.key.key:a.key;a=this.s.listenKeys.split("");
b=d.inArray(b,a);a.splice(b,1);this.s.listenKeys=a.join("")}},_resolveExtends:function(a){var b=this.s.dt,c,e=function(g){for(var l=0;!d.isPlainObject(g)&&!d.isArray(g);){if(g===v)return;if("function"===typeof g){if(g=g(b,a),!g)return!1}else if("string"===typeof g){if(!t[g])throw"Unknown button type: "+g;g=t[g]}l++;if(30<l)throw"Buttons: Too many iterations";}return d.isArray(g)?g:d.extend({},g)};for(a=e(a);a&&a.extend;){if(!t[a.extend])throw"Cannot extend unknown button type: "+a.extend;var f=e(t[a.extend]);
if(d.isArray(f))return f;if(!f)return!1;var h=f.className;a=d.extend({},f,a);h&&a.className!==h&&(a.className=h+" "+a.className);var k=a.postfixButtons;if(k){a.buttons||(a.buttons=[]);h=0;for(c=k.length;h<c;h++)a.buttons.push(k[h]);a.postfixButtons=null}if(k=a.prefixButtons){a.buttons||(a.buttons=[]);h=0;for(c=k.length;h<c;h++)a.buttons.splice(h,0,k[h]);a.prefixButtons=null}a.extend=f.extend}return a}});u.background=function(a,b,c){c===v&&(c=400);a?d("<div/>").addClass(b).css("display","none").appendTo("body").fadeIn(c):
d("body > div."+b).fadeOut(c,function(){d(this).removeClass(b).remove()})};u.instanceSelector=function(a,b){if(!a)return d.map(b,function(h){return h.inst});var c=[],e=d.map(b,function(h){return h.name}),f=function(h){if(d.isArray(h))for(var k=0,g=h.length;k<g;k++)f(h[k]);else"string"===typeof h?-1!==h.indexOf(",")?f(h.split(",")):(h=d.inArray(d.trim(h),e),-1!==h&&c.push(b[h].inst)):"number"===typeof h&&c.push(b[h].inst)};f(a);return c};u.buttonSelector=function(a,b){for(var c=[],e=function(g,l,m){for(var p,
n,w=0,z=l.length;w<z;w++)if(p=l[w])n=m!==v?m+w:w+"",g.push({node:p.node,name:p.conf.name,idx:n}),p.buttons&&e(g,p.buttons,n+"-")},f=function(g,l){var m,p=[];e(p,l.s.buttons);var n=d.map(p,function(w){return w.node});if(d.isArray(g)||g instanceof d)for(n=0,m=g.length;n<m;n++)f(g[n],l);else if(null===g||g===v||"*"===g)for(n=0,m=p.length;n<m;n++)c.push({inst:l,node:p[n].node});else if("number"===typeof g)c.push({inst:l,node:l.s.buttons[g].node});else if("string"===typeof g)if(-1!==g.indexOf(","))for(p=
g.split(","),n=0,m=p.length;n<m;n++)f(d.trim(p[n]),l);else if(g.match(/^\d+(\-\d+)*$/))n=d.map(p,function(w){return w.idx}),c.push({inst:l,node:p[d.inArray(g,n)].node});else if(-1!==g.indexOf(":name"))for(g=g.replace(":name",""),n=0,m=p.length;n<m;n++)p[n].name===g&&c.push({inst:l,node:p[n].node});else d(n).filter(g).each(function(){c.push({inst:l,node:this})});else"object"===typeof g&&g.nodeName&&(p=d.inArray(g,n),-1!==p&&c.push({inst:l,node:n[p]}))},h=0,k=a.length;h<k;h++)f(b,a[h]);return c};u.defaults=
{buttons:["copy","excel","csv","pdf","print"],name:"main",tabIndex:0,dom:{container:{tag:"div",className:"dt-buttons"},collection:{tag:"div",className:"dt-button-collection"},button:{tag:"a",className:"dt-button",active:"active",disabled:"disabled"},buttonLiner:{tag:"span",className:""}}};u.version="1.3.0";d.extend(t,{collection:{text:function(a){return a.i18n("buttons.collection","Collection")},className:"buttons-collection",action:function(a,b,c,e){a=c.offset();var f=d(b.table().container()),h=
!1;d("div.dt-button-background").length&&(h=d(".dt-button-collection").offset(),d("body").trigger("click.dtb-collection"));e._collection.addClass(e.collectionLayout).css("display","none").appendTo("body").fadeIn(e.fade);var k=e._collection.css("position");h&&"absolute"===k?e._collection.css({top:h.top,left:h.left}):"absolute"===k?(e._collection.css({top:a.top+c.outerHeight(),left:a.left}),c=a.left+e._collection.outerWidth(),f=f.offset().left+f.width(),c>f&&e._collection.css("left",a.left-(c-f))):
(a=e._collection.height()/2,a>d(x).height()/2&&(a=d(x).height()/2),e._collection.css("marginTop",-1*a));e.background&&u.background(!0,e.backgroundClassName,e.fade);setTimeout(function(){d("div.dt-button-background").on("click.dtb-collection",function(){});d("body").on("click.dtb-collection",function(g){var l=d.fn.addBack?"addBack":"andSelf";d(g.target).parents()[l]().filter(e._collection).length||(e._collection.fadeOut(e.fade,function(){e._collection.detach()}),d("div.dt-button-background").off("click.dtb-collection"),
u.background(!1,e.backgroundClassName,e.fade),d("body").off("click.dtb-collection"),b.off("buttons-action.b-internal"))})},10);if(e.autoClose)b.on("buttons-action.b-internal",function(){d("div.dt-button-background").click()})},background:!0,collectionLayout:"",backgroundClassName:"dt-button-background",autoClose:!1,fade:400},copy:function(a,b){if(t.copyHtml5)return"copyHtml5";if(t.copyFlash&&t.copyFlash.available(a,b))return"copyFlash"},csv:function(a,b){if(t.csvHtml5&&t.csvHtml5.available(a,b))return"csvHtml5";
if(t.csvFlash&&t.csvFlash.available(a,b))return"csvFlash"},excel:function(a,b){if(t.excelHtml5&&t.excelHtml5.available(a,b))return"excelHtml5";if(t.excelFlash&&t.excelFlash.available(a,b))return"excelFlash"},pdf:function(a,b){if(t.pdfHtml5&&t.pdfHtml5.available(a,b))return"pdfHtml5";if(t.pdfFlash&&t.pdfFlash.available(a,b))return"pdfFlash"},pageLength:function(a){a=a.settings()[0].aLengthMenu;var b=d.isArray(a[0])?a[0]:a,c=d.isArray(a[0])?a[1]:a,e=function(f){return f.i18n("buttons.pageLength",{"-1":"Show all rows",
_:"Show %d rows"},f.page.len())};return{extend:"collection",text:e,className:"buttons-page-length",autoClose:!0,buttons:d.map(b,function(f,h){return{text:c[h],className:"button-page-length",action:function(k,g){g.page.len(f).draw()},init:function(k,g,l){var m=this;g=function(){m.active(k.page.len()===f)};k.on("length.dt"+l.namespace,g);g()},destroy:function(k,g,l){k.off("length.dt"+l.namespace)}}}),init:function(f,h,k){var g=this;f.on("length.dt"+k.namespace,function(){g.text(e(f))})},destroy:function(f,
h,k){f.off("length.dt"+k.namespace)}}}});r.Api.register("buttons()",function(a,b){b===v&&(b=a,a=v);this.selector.buttonGroup=a;var c=this.iterator(!0,"table",function(e){if(e._buttons)return u.buttonSelector(u.instanceSelector(a,e._buttons),b)},!0);c._groupSelector=a;return c});r.Api.register("button()",function(a,b){a=this.buttons(a,b);1<a.length&&a.splice(1,a.length);return a});r.Api.registerPlural("buttons().active()","button().active()",function(a){return a===v?this.map(function(b){return b.inst.active(b.node)}):
this.each(function(b){b.inst.active(b.node,a)})});r.Api.registerPlural("buttons().action()","button().action()",function(a){return a===v?this.map(function(b){return b.inst.action(b.node)}):this.each(function(b){b.inst.action(b.node,a)})});r.Api.register(["buttons().enable()","button().enable()"],function(a){return this.each(function(b){b.inst.enable(b.node,a)})});r.Api.register(["buttons().disable()","button().disable()"],function(){return this.each(function(a){a.inst.disable(a.node)})});r.Api.registerPlural("buttons().nodes()",
"button().node()",function(){var a=d();d(this.each(function(b){a=a.add(b.inst.node(b.node))}));return a});r.Api.registerPlural("buttons().processing()","button().processing()",function(a){return a===v?this.map(function(b){return b.inst.processing(b.node)}):this.each(function(b){b.inst.processing(b.node,a)})});r.Api.registerPlural("buttons().text()","button().text()",function(a){return a===v?this.map(function(b){return b.inst.text(b.node)}):this.each(function(b){b.inst.text(b.node,a)})});r.Api.registerPlural("buttons().trigger()",
"button().trigger()",function(){return this.each(function(a){a.inst.node(a.node).trigger("click")})});r.Api.registerPlural("buttons().containers()","buttons().container()",function(){var a=d(),b=this._groupSelector;this.iterator(!0,"table",function(c){if(c._buttons){c=u.instanceSelector(b,c._buttons);for(var e=0,f=c.length;e<f;e++)a=a.add(c[e].container())}});return a});r.Api.register("button().add()",function(a,b){var c=this.context;c.length&&(c=u.instanceSelector(this._groupSelector,c[0]._buttons),
c.length&&c[0].add(b,a));return this.button(this._groupSelector,a)});r.Api.register("buttons().destroy()",function(){this.pluck("inst").unique().each(function(a){a.destroy()});return this});r.Api.registerPlural("buttons().remove()","buttons().remove()",function(){this.each(function(a){a.inst.remove(a.node)});return this});var B;r.Api.register("buttons.info()",function(a,b,c){var e=this;if(!1===a)return d("#datatables_buttons_info").fadeOut(function(){d(this).remove()}),clearTimeout(B),B=null,this;
B&&clearTimeout(B);d("#datatables_buttons_info").length&&d("#datatables_buttons_info").remove();a=a?"<h2>"+a+"</h2>":"";d('<div id="datatables_buttons_info" class="dt-button-info"/>').html(a).append(d("<div/>")["string"===typeof b?"html":"append"](b)).css("display","none").appendTo("body").fadeIn();c!==v&&0!==c&&(B=setTimeout(function(){e.buttons.info(!1)},c));return this});r.Api.register("buttons.exportData()",function(a){if(this.context.length)return F(new r.Api(this.context[0]),a)});var C=d("<textarea/>")[0],
F=function(a,b){var c=d.extend(!0,{},{rows:null,columns:"",modifier:{search:"applied",order:"applied"},orthogonal:"display",stripHtml:!0,stripNewlines:!0,decodeEntities:!0,trim:!0,format:{header:function(q){return e(q)},footer:function(q){return e(q)},body:function(q){return e(q)}}},b),e=function(q){if("string"!==typeof q)return q;q=q.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");c.stripHtml&&(q=q.replace(/<[^>]*>/g,""));c.trim&&(q=q.replace(/^\s+|\s+$/g,""));c.stripNewlines&&
(q=q.replace(/\n/g," "));c.decodeEntities&&(C.innerHTML=q,q=C.value);return q};b=a.columns(c.columns).indexes().map(function(q){var A=a.column(q).header();return c.format.header(A.innerHTML,q,A)}).toArray();var f=a.table().footer()?a.columns(c.columns).indexes().map(function(q){var A=a.column(q).footer();return c.format.footer(A?A.innerHTML:"",q,A)}).toArray():null,h=a.rows(c.rows,c.modifier).indexes().toArray(),k=a.cells(h,c.columns);h=k.render(c.orthogonal).toArray();k=k.nodes().toArray();for(var g=
b.length,l=0<g?h.length/g:0,m=Array(l),p=0,n=0;n<l;n++){for(var w=Array(g),z=0;z<g;z++)w[z]=c.format.body(h[p],n,z,k[p]),p++;m[n]=w}return{header:b,footer:f,body:m}};d.fn.dataTable.Buttons=u;d.fn.DataTable.Buttons=u;d(y).on("init.dt plugin-init.dt",function(a,b){"dt"===a.namespace&&(a=b.oInit.buttons||r.defaults.buttons)&&!b._buttons&&(new u(b,a)).container()});r.ext.feature.push({fnInit:function(a){a=new r.Api(a);var b=a.init().buttons||r.defaults.buttons;return(new u(a,b)).container()},cFeature:"B"});
return u});
